<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1280" height="520" viewBox="0 0 1280 520">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="10" refY="5" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,5 L0,10 z" fill="#4a5568" />
    </marker>
    <style>
      .title { font: 700 20px/1.4 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial; fill: #1a202c; }
      .box { fill: #edf2f7; stroke: #a0aec0; stroke-width: 1.5; rx: 8; ry: 8; }
      .box-plugin { fill: #e6fffa; stroke: #38b2ac; }
      .box-core { fill: #ebf8ff; stroke: #4299e1; }
      .label { font: 600 14px/1.4 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial; fill: #2d3748; }
      .desc { font: 12px/1.4 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial; fill: #4a5568; }
      .small { font: 11px/1.4 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial; fill: #718096; }
      .group { fill: none; stroke: #cbd5e0; stroke-width: 2; stroke-dasharray: 6 6; rx: 10; ry: 10; }
      .arrow { stroke: #4a5568; stroke-width: 1.8; fill: none; marker-end: url(#arrow); }
      .arrow-text { font: 12px/1.4 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial; fill: #2d3748; }
    </style>
  </defs>

  <!-- Title -->
  <text x="40" y="40" class="title">tegg 架构时序/组件图：装饰器 → 元数据 → 装载器 → 运行时 → 插件</text>

  <!-- Core boundary -->
  <rect x="20" y="60" width="980" height="360" class="group" />
  <text x="30" y="80" class="small">Core 边界（与框架解耦）</text>

  <!-- Plugin boundary -->
  <rect x="1020" y="60" width="240" height="360" class="group" />
  <text x="1030" y="80" class="small">Plugin 边界（与 Egg 集成）</text>

  <!-- Boxes -->
  <!-- Decorators -->
  <rect x="40" y="110" width="200" height="120" class="box box-core" />
  <text x="60" y="140" class="label">Decorators</text>
  <text x="60" y="162" class="desc">类/方法/参数装饰器</text>
  <text x="60" y="182" class="desc">声明意图（领域/控制器等）</text>
  <text x="60" y="202" class="small">位置：core/*-decorator</text>

  <!-- Metadata -->
  <rect x="280" y="110" width="200" height="120" class="box box-core" />
  <text x="300" y="140" class="label">Metadata</text>
  <text x="300" y="162" class="desc">Class/Property/Param Metadata</text>
  <text x="300" y="182" class="desc">可扫描、可序列化的中间表示</text>
  <text x="300" y="202" class="small">位置：core/metadata</text>

  <!-- Loader -->
  <rect x="520" y="110" width="200" height="120" class="box box-core" />
  <text x="540" y="140" class="label">Loader</text>
  <text x="540" y="162" class="desc">扫描工程/解析元数据</text>
  <text x="540" y="182" class="desc">构建 LoadUnit / Prototype</text>
  <text x="540" y="202" class="small">位置：core/loader</text>

  <!-- Runtime -->
  <rect x="760" y="110" width="220" height="120" class="box box-core" />
  <text x="780" y="140" class="label">Runtime</text>
  <text x="780" y="162" class="desc">DI/生命周期/作用域/上下文</text>
  <text x="780" y="182" class="desc">AsyncLocalStorage 传递上下文</text>
  <text x="780" y="202" class="small">位置：core/runtime</text>

  <!-- Plugins -->
  <rect x="1040" y="110" width="200" height="120" class="box box-plugin" />
  <text x="1060" y="140" class="label">Plugins</text>
  <text x="1060" y="162" class="desc">HTTP/路由/配置/中间件集成</text>
  <text x="1060" y="182" class="desc">将核心能力对接 Egg</text>
  <text x="1060" y="202" class="small">位置：plugin/*</text>

  <!-- Flow arrows -->
  <path d="M240,170 L275,170" class="arrow" />
  <text x="230" y="155" class="arrow-text" text-anchor="end">declare</text>

  <path d="M480,170 L515,170" class="arrow" />
  <text x="480" y="155" class="arrow-text">emit → ClassMetadata 等</text>

  <path d="M720,170 L755,170" class="arrow" />
  <text x="720" y="155" class="arrow-text">scan/build → LoadUnit, Prototype</text>

  <path d="M980,170 L1035,170" class="arrow" />
  <text x="990" y="155" class="arrow-text">invoke/integrate → HTTP/Config</text>

  <!-- Types shared contract -->
  <rect x="40" y="270" width="920" height="70" class="box" />
  <text x="60" y="295" class="label">Types（跨包契约）</text>
  <text x="60" y="315" class="desc">@eggjs/tegg-types：共享接口/类型，降低编译与重构耦合</text>

  <!-- Dotted connectors to types -->
  <path d="M140,230 C140,250 140,250 140,270" stroke="#718096" stroke-dasharray="4 4" fill="none"/>
  <path d="M380,230 C380,250 380,250 380,270" stroke="#718096" stroke-dasharray="4 4" fill="none"/>
  <path d="M620,230 C620,250 620,250 620,270" stroke="#718096" stroke-dasharray="4 4" fill="none"/>
  <path d="M830,230 C830,250 830,250 830,270" stroke="#718096" stroke-dasharray="4 4" fill="none"/>

  <!-- Legend -->
  <rect x="40" y="370" width="1200" height="40" class="box" />
  <text x="60" y="395" class="small">说明：</text>
  <text x="100" y="395" class="small">装饰器将领域/控制器意图显式化 → 元数据可被扫描 → 装载器生成可装配单元 → 运行时完成依赖注入/上下文传递 → 插件把能力接入 Egg。</text>
</svg>